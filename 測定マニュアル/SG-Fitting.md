# SGフィッティング 概要

## 目的
測定データから不要なノイズを除去しながら、重要な特徴（ピーク、エッジなど）を保持すること

## 3つの主要プロセス

### 1. 大きなスパイク除去
- 正規化された傾きを分析
- 異常値を検出し、周辺データから適切な値に置換
- 連続的なスパイクにも対応

### 2. 小さなスパイク除去
- 周囲7点との比較で微小な異常を検出
- 2段階の閾値（1%→0.3%）で処理
- ペナンブラ領域では適用しない

### 3. カーブフィッティング
- 2次のSavitzky-Golayフィルターを使用
- 適応的なフィッティング範囲（6～160点）
- データ特性に応じて最適な結果を選択

## 重要な特徴
1. 適応性
   - データ密度に応じた処理
   - 領域特性に応じたフィッティング

2. 安全性
   - 段階的なスパイク除去
   - 複数の品質チェック
   - 結果の連続性確保

3. 特別な配慮
   - ペナンブラ領域での制限
   - 深度測定での厳密な条件
   - エッジ部分での慎重な処理

## 処理の注意点
- データ密度の確保が重要
- 急激な変化がある領域での注意
- 処理前後の比較確認が推奨